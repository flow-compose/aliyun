packages = ["github.com/flow-contrib/aliyun"]

app {
    name = "devops"
    usage = "fast build a devops development environment on aliyun"

    commands {
        create {
            usage = "create aliyun infrastructure instance"
            ecs {
                usage = "create infrastructure of ecs"

                vpc {
                    usage = "create vpc instance"

                    default-config = {}

                    flow = ["devops.aliyun.ecs.vpc.create", "devops.aliyun.ecs.vpc.running.wait"]
                }

                vswitch {
                    usage = "create vpc vswitch"

                    default-config = {}

                    flow = ["devops.aliyun.ecs.vswitch.create"]
                }
            }

            oss {
                usage = "create oss bucket"
                flow = ["devops.aliyun.oss.bucket.create"]
            }

            slb {
                usage = "create load balancer instance"

                flow = [
                    "devops.aliyun.slb.balancer.create",
                    "devops.aliyun.slb.balancer.listener.http.create",
                    "devops.aliyun.slb.balancer.listener.tcp.create",
                    "devops.aliyun.slb.balancer.listener.udp.create",
                    "devops.aliyun.slb.balancer.listener.vserver-group.create",
                    "devops.aliyun.slb.balancer.listener.rules.create"
                ]
            }

            rds {
                usage = "create database instance"

                flow = [
                    "devops.aliyun.rds.instance.create",
                    "devops.aliyun.rds.instance.running.wait"
                ]
            }

            cs {
                usage = "create container service infrastructure"

                cluster {
                    usage = "create cluster"

                    flow  = [
                        "devops.aliyun.cs.cluster.create",
                        "devops.aliyun.cs.cluster.running.wait"
                    ]
                }

                volume {
                    usage = "create volume"

                    flow  = [
                        "devops.aliyun.cs.cluster.volume.create"
                    ]
                }

                project {
                    usage = "create project"

                    flow  = [
                        "devops.aliyun.cs.cluster.project.create"
                    ]
                }
            }

            all {
                usage = "create all infrastructure instance"

                default-config = {}

                flow = [
                    "devops.aliyun.ecs.vpc.create",
                    "devops.aliyun.ecs.vpc.running.wait",
                    "devops.aliyun.ecs.vswitch.create",
                    "devops.aliyun.oss.bucket.create",
                    "devops.aliyun.rds.instance.create",
                    "devops.aliyun.rds.instance.running.wait",
                    "devops.aliyun.cs.cluster.create",
                    "devops.aliyun.cs.cluster.running.wait",
                    "devops.aliyun.cs.cluster.volume.create",
                    "devops.aliyun.cs.cluster.project.create",
                    "devops.aliyun.slb.balancer.create",
                    "devops.aliyun.slb.balancer.listener.http.create",
                    "devops.aliyun.slb.balancer.listener.tcp.create",
                    "devops.aliyun.slb.balancer.listener.udp.create",
                    "devops.aliyun.slb.balancer.listener.vserver-group.create",
                    "devops.aliyun.slb.balancer.listener.rules.create"
                ]
            }
        }

        delete {
            usage = "delete aliyun infrastructure instance"
            ecs {
                usage = "delete infrastructure of ecs"

                vpc {
                    usage = "delete vpc instance"

                    default-config = {}

                    flow = ["devops.aliyun.ecs.vpc.delete"]
                }

                vswitch {
                    usage = "delete vswitch instance"

                    default-config = {}

                    flow = ["devops.aliyun.ecs.vswitch.delete"]
                }
            }

            oss {
                usage = "delete oss bucket"
                flow = ["devops.aliyun.oss.bucket.delete"]
            }

            slb {
                usage = "delete load balancer instance"

                flow = ["devops.aliyun.slb.balancer.delete"]
            }

            rds {
                usage = "delete database instance"

                flow = ["devops.aliyun.rds.instance.delete"]
            }

            cs {
                usage = "delete container service infrastructure"

                cluster {
                    usage = "delete cluster"

                    flow  = [
                       "devops.aliyun.cs.cluster.delete",
                       "devops.aliyun.cs.cluster.deleted.wait"
                    ]
                }

                project {
                    usage = "delete project"

                    flow  = ["devops.aliyun.cs.cluster.project.delete"]
                }
            }

            all {
                usage = "delete all infrastructure instance"

                default-config = {}

                flow = [
                    "devops.aliyun.cs.cluster.project.delete",
                    "devops.aliyun.cs.cluster.delete",
                    "devops.aliyun.cs.cluster.deleted.wait",
                    "devops.aliyun.rds.instance.delete",
                    "devops.aliyun.oss.bucket.delete",
                    "devops.aliyun.slb.balancer.delete",
                    "devops.aliyun.ecs.vswitch.delete",
                    "devops.aliyun.ecs.vpc.delete"
                ]
            }
        }
    }
}